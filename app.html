<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GESTIUM ¬∑ Inteligencia Operativa</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GESTIUM ¬∑ app.html ¬∑ Estilos Globales
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root{
  --navy:#070d1a;--navy2:#0d1629;--navy3:#111e35;--navy4:#1a2a45;
  --orange:#f97316;--orange2:#fb923c;
  --teal:#06d6c8;--teal2:#22d3ee;--teal3:#67e8f9;
  --text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;
  --white:#ffffff;--red:#ef4444;--amber:#f59e0b;--green:#10b981;--purple:#8b5cf6;
  --r:10px;--r2:16px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:15px;scroll-behavior:smooth}
body{font-family:'Syne',system-ui,sans-serif;background:var(--navy);color:var(--text);-webkit-font-smoothing:antialiased;min-height:100vh}

/* ‚ïê‚ïê‚ïê FONDO ANIMADO GIRATORIO ‚ïê‚ïê‚ïê */
.bg-orb{position:fixed;pointer-events:none;z-index:0;border-radius:50%;filter:blur(80px);opacity:.12}
.bg-orb-1{width:600px;height:600px;background:var(--teal);bottom:-200px;left:-150px;animation:orbSpin 25s linear infinite}
.bg-orb-2{width:500px;height:500px;background:var(--orange);top:-150px;right:-100px;animation:orbSpin 20s linear infinite reverse}
.bg-orb-3{width:300px;height:300px;background:var(--purple);top:50%;left:50%;animation:orbFloat 18s ease-in-out infinite}
@keyframes orbSpin{0%{transform:rotate(0deg) scale(1)}50%{transform:rotate(180deg) scale(1.1)}100%{transform:rotate(360deg) scale(1)}}
@keyframes orbFloat{0%,100%{transform:translate(-50%,-50%) scale(1)}33%{transform:translate(-60%,-40%) scale(1.15)}66%{transform:translate(-40%,-60%) scale(.9)}}

/* ‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê */
#loginScreen{display:flex;min-height:100vh;background:var(--navy);overflow:hidden;position:relative}
#loginScreen::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 15% 50%,rgba(6,214,200,.12) 0%,transparent 55%),radial-gradient(ellipse at 85% 20%,rgba(249,115,22,.14) 0%,transparent 50%);pointer-events:none;animation:gShift 8s ease infinite}
@keyframes gShift{0%,100%{opacity:1;transform:translateX(0)}50%{opacity:.8;transform:translateX(20px) translateY(-15px)}}
.login-grid-bg{position:absolute;inset:0;background-image:linear-gradient(rgba(6,214,200,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(6,214,200,.04) 1px,transparent 1px);background-size:60px 60px;pointer-events:none}
.login-deco{flex:1;display:flex;flex-direction:column;justify-content:center;padding:72px;position:relative;z-index:1}
.login-eyebrow{font-size:10px;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:var(--teal);margin-bottom:22px;display:flex;align-items:center;gap:10px}
.login-eyebrow::before{content:'';width:32px;height:2px;background:var(--teal)}
.login-headline{font-size:clamp(32px,4vw,56px);font-weight:800;line-height:1.05;color:var(--white);margin-bottom:20px;letter-spacing:-1px}
.login-headline em{color:var(--orange);font-style:normal;text-shadow:0 0 40px rgba(249,115,22,.4)}
.login-tagline{font-size:15px;color:var(--text2);line-height:1.7;max-width:380px;margin-bottom:40px}
.login-chips{display:flex;gap:10px;flex-wrap:wrap}
.login-chip{padding:9px 17px;border-radius:100px;border:1px solid rgba(6,214,200,.2);color:var(--teal3);font-size:11px;font-weight:600;background:rgba(6,214,200,.05);transition:all .2s;cursor:default}
.login-chip:hover{background:rgba(6,214,200,.12);border-color:rgba(6,214,200,.4);transform:translateY(-2px)}
.login-panel{width:440px;min-height:100vh;background:var(--navy2);display:flex;flex-direction:column;justify-content:center;padding:60px 48px;position:relative;z-index:1;border-left:1px solid rgba(6,214,200,.08)}
.login-panel::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--teal),var(--orange))}
.login-logo-text{font-size:22px;font-weight:800;color:var(--white);letter-spacing:2px;margin-bottom:4px}
.login-logo-text span{color:var(--orange)}
.login-sub-text{font-size:11px;color:var(--teal);letter-spacing:2px;text-transform:uppercase;font-weight:600;margin-bottom:32px}
.f-label{display:block;font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text3);margin-bottom:7px}
.f-input{width:100%;padding:12px 16px;border-radius:var(--r);border:1.5px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);font-family:inherit;font-size:14px;color:var(--text);outline:none;transition:border-color .2s,box-shadow .2s}
.f-input:focus{border-color:var(--teal);box-shadow:0 0 0 3px rgba(6,214,200,.12)}
.f-input::placeholder{color:var(--text3)}
.pw-wrap{position:relative}.pw-wrap .f-input{padding-right:44px}
.pw-eye{position:absolute;right:14px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:14px;opacity:.4;transition:opacity .2s}
.pw-eye:hover{opacity:1}
.login-row{display:flex;justify-content:space-between;align-items:center;margin:12px 0 22px}
.rem-label{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--text2);cursor:pointer}
.rem-label input{accent-color:var(--teal);width:14px;height:14px}
.login-msg{min-height:18px;font-size:12px;color:var(--red);text-align:center;margin-top:12px}
.login-footer{text-align:center;margin-top:22px;font-size:12px;color:var(--text3)}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.shake{animation:shake .3s ease}
.input-error{border-color:var(--red)!important;box-shadow:0 0 0 3px rgba(239,68,68,.1)!important}
@media(max-width:800px){.login-deco{display:none}.login-panel{width:100%;padding:40px 24px}}

/* ‚ïê‚ïê‚ïê BOTONES ‚ïê‚ïê‚ïê */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;cursor:pointer;border:none;font-family:inherit;font-size:14px;font-weight:700;border-radius:var(--r);padding:13px 22px;transition:transform .14s,box-shadow .14s;letter-spacing:.3px}
.btn:active{transform:scale(.97)}
.btn-primary{background:linear-gradient(135deg,var(--teal),var(--orange));color:#fff;box-shadow:0 4px 20px rgba(249,115,22,.25);width:100%}
.btn-primary:hover{box-shadow:0 6px 30px rgba(249,115,22,.4)}
.btn-ghost{background:none;color:var(--teal);font-size:12px;padding:5px 0;font-weight:600}
.btn-sm{padding:8px 16px;font-size:12px;border-radius:8px}
.btn-navy{background:var(--navy4);color:var(--text);border:1px solid rgba(255,255,255,.08)}
.btn-teal{background:rgba(6,214,200,.12);color:var(--teal);border:1px solid rgba(6,214,200,.2)}
.btn-orange{background:rgba(249,115,22,.15);color:var(--orange);border:1px solid rgba(249,115,22,.2)}
.btn-danger{background:rgba(239,68,68,.12);color:var(--red);border:1px solid rgba(239,68,68,.2)}
.btn-purple{background:rgba(139,92,246,.12);color:var(--purple);border:1px solid rgba(139,92,246,.2)}
.btn-icon-teal{background:rgba(6,214,200,.1);border:1px solid rgba(6,214,200,.2);border-radius:6px;cursor:pointer;font-size:13px;padding:4px 8px;color:var(--teal);transition:background .15s}
.btn-icon-teal:hover{background:rgba(6,214,200,.2)}

/* ‚ïê‚ïê‚ïê REGISTRO ‚ïê‚ïê‚ïê */
#registerScreen{display:none;min-height:100vh;background:var(--navy);align-items:flex-start;justify-content:center;padding:48px 20px;overflow-y:auto;position:relative}
#registerScreen::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 30% 40%,rgba(6,214,200,.08) 0%,transparent 50%),radial-gradient(ellipse at 70% 70%,rgba(249,115,22,.08) 0%,transparent 50%);pointer-events:none}
.reg-card{width:560px;max-width:100%;background:var(--navy2);border-radius:var(--r2);box-shadow:0 8px 40px rgba(0,0,0,.5);border:1px solid rgba(6,214,200,.1);overflow:hidden;position:relative;z-index:1;animation:fadeUp .35s ease both}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.reg-head{background:linear-gradient(135deg,var(--navy3),var(--navy4));padding:32px 40px 28px;border-bottom:1px solid rgba(6,214,200,.1);position:relative;overflow:hidden}
.reg-head::after{content:'';position:absolute;top:-30px;right:-30px;width:120px;height:120px;border-radius:50%;background:radial-gradient(circle,rgba(249,115,22,.15),transparent)}
.reg-head h2{font-size:22px;font-weight:800;color:var(--white);margin-bottom:4px;position:relative;z-index:1}
.reg-head p{font-size:12px;color:var(--text3);position:relative;z-index:1}
.reg-body{padding:28px 40px 36px}
.reg-sep{display:flex;align-items:center;gap:10px;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--teal);margin:22px 0 12px}
.reg-sep::before,.reg-sep::after{content:'';flex:1;height:1px;background:rgba(6,214,200,.15)}
.reg-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:500px){.reg-2{grid-template-columns:1fr}}
.ri{width:100%;padding:11px 14px;border-radius:8px;border:1.5px solid rgba(255,255,255,.07);background:rgba(255,255,255,.03);font-family:inherit;font-size:13px;color:var(--text);outline:none;transition:border-color .2s;margin-bottom:8px}
.ri::placeholder{color:var(--text3)}
.ri:focus{border-color:var(--teal);box-shadow:0 0 0 3px rgba(6,214,200,.1)}
.reg-msg{min-height:18px;font-size:12px;color:var(--red);text-align:center;margin-top:8px}
.mode-tgl{display:flex;border-radius:8px;overflow:hidden;border:1.5px solid rgba(255,255,255,.08);margin-bottom:18px}
.mode-btn{flex:1;padding:10px 14px;background:transparent;border:none;font-family:inherit;font-size:12px;font-weight:700;color:var(--text3);cursor:pointer;transition:background .15s,color .15s}
.mode-btn.on{background:var(--navy4);color:var(--teal)}

/* ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê */
#app{display:none}
#suspendedScreen{display:none;min-height:100vh;align-items:center;justify-content:center;padding:20px}
.suspended-card{background:var(--navy2);border-radius:var(--r2);border:1px solid rgba(239,68,68,.2);padding:48px;text-align:center;max-width:440px}
.suspended-icon{font-size:64px;margin-bottom:20px}
.suspended-title{font-size:24px;font-weight:800;color:var(--red);margin-bottom:10px}
.suspended-text{font-size:14px;color:var(--text2);line-height:1.7}

/* ‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê */
.sidebar{position:fixed;left:0;top:0;width:256px;height:100vh;background:var(--navy2);display:flex;flex-direction:column;z-index:200;border-right:1px solid rgba(6,214,200,.06)}
.sb-stripe{height:3px;background:linear-gradient(90deg,var(--teal),var(--orange))}
.sb-top{padding:20px 20px 14px;border-bottom:1px solid rgba(255,255,255,.04)}
.sb-brand{font-size:9px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--teal);margin-bottom:6px;display:flex;align-items:center;gap:8px}
.sb-brand::before{content:'';width:20px;height:1px;background:var(--teal)}
.sb-company{font-size:14px;font-weight:800;color:var(--white);word-break:break-word;line-height:1.3;margin-bottom:6px}
.plan-pill{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:100px;font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase}
.plan-pill.trial{background:rgba(245,158,11,.1);color:var(--amber);border:1px solid rgba(245,158,11,.25)}
.plan-pill.basico{background:rgba(100,116,139,.1);color:var(--text2);border:1px solid rgba(100,116,139,.25)}
.plan-pill.premium{background:rgba(6,214,200,.08);color:var(--teal);border:1px solid rgba(6,214,200,.2)}
.plan-pill.superpremium{background:linear-gradient(135deg,rgba(6,214,200,.12),rgba(139,92,246,.12));color:#a78bfa;border:1px solid rgba(139,92,246,.3)}
.topbar-badge.superpremium{color:#a78bfa;background:rgba(139,92,246,.1);border-color:rgba(139,92,246,.25)}

/* ‚ïê‚ïê‚ïê CONTABILIDAD ‚ïê‚ïê‚ïê */
.contab-table{width:100%;border-collapse:collapse;font-size:12px}
.contab-table thead th{background:rgba(6,214,200,.06);color:var(--teal);padding:9px 12px;text-align:left;font-size:10px;letter-spacing:.8px;text-transform:uppercase;border-bottom:1px solid rgba(6,214,200,.1)}
.contab-table td{padding:9px 12px;border-bottom:1px solid rgba(255,255,255,.04);vertical-align:middle}
.contab-table .sec-header td{background:rgba(255,255,255,.03);color:var(--text3);font-size:9px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;padding:7px 12px}
.contab-table .sub td{background:rgba(6,214,200,.04);font-size:12px}
.contab-table .tot td{background:rgba(7,13,26,.8);font-size:13px;border-top:1px solid rgba(6,214,200,.2)}
.contab-table .tot.cuadra td{color:var(--green)}
.contab-table .tot.descuadra td{color:var(--red)}
.contab-table .cuenta{color:var(--text2);font-family:'JetBrains Mono',monospace;font-size:11px}
.contab-table .ing td{border-left:3px solid var(--teal)}
.contab-table .cto td{border-left:3px solid var(--red)}
.contab-table .gto td{border-left:3px solid var(--amber)}
.contab-table .imp td{border-left:3px solid var(--orange)}
.contab-table tr:hover td{background:rgba(255,255,255,.02)}
.monto{font-family:'JetBrains Mono',monospace;font-size:12px;text-align:right}
.monto.pos{color:var(--green)}.monto.neg{color:var(--red)}
.fc-row{display:flex;justify-content:space-between;align-items:center;padding:11px 16px;border-bottom:1px solid rgba(255,255,255,.04);font-size:13px}
.fc-row.tot{background:rgba(6,214,200,.04);font-size:14px}
.fc-pred-card{background:var(--navy3);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,.06);position:relative}
.fc-pred-card.riesgo{border-color:rgba(239,68,68,.3);background:rgba(239,68,68,.05)}
.fc-pred-label{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text3);margin-bottom:8px}
.fc-pred-ent{font-size:12px;color:var(--green);margin-bottom:3px}
.fc-pred-sal{font-size:12px;color:var(--text2);margin-bottom:3px}
.fc-pred-sal2{font-size:16px;font-weight:700;font-family:'JetBrains Mono',monospace;margin-top:6px}
.alerta-riesgo{font-size:10px;color:var(--red);margin-top:6px;font-weight:700}
.cxc-row{display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:12px;flex-wrap:wrap}
.cxc-row.vencida{background:rgba(239,68,68,.04);border-left:3px solid var(--red);padding-left:8px}
.score-bar{display:flex;align-items:center;gap:6px}
.score-bar > div:first-child{height:6px;border-radius:3px;min-width:4px;max-width:80px;transition:width .3s}
.score-bar > span{font-size:11px;font-family:'JetBrains Mono',monospace;color:var(--text2)}
.tarea-cierre{display:flex;gap:10px;align-items:center;padding:10px 14px;border-radius:8px;font-size:13px;margin-bottom:6px}
.tarea-cierre.ok{background:rgba(16,185,129,.06);border:1px solid rgba(16,185,129,.15)}
.tarea-cierre.pendiente{background:rgba(245,158,11,.06);border:1px solid rgba(245,158,11,.15)}
.contab-tabs{display:flex;border-bottom:1px solid rgba(255,255,255,.06);margin-bottom:20px;gap:4px;flex-wrap:wrap}
.contab-tab{padding:10px 18px;background:none;border:none;border-bottom:2px solid transparent;color:var(--text3);font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;letter-spacing:.3px}
.contab-tab.active{color:var(--teal);border-bottom-color:var(--teal)}
.contab-tab:hover{color:var(--text)}
.contab-section{display:none}.contab-section.active{display:block}
.sim-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px;margin-bottom:20px}
.sim-card{background:var(--navy3);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,.06)}
.sim-lbl{font-size:10px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;color:var(--text3);margin-bottom:6px}
.sim-val{display:flex;align-items:center;gap:8px}
.sim-val span{font-size:18px;font-weight:700;color:var(--teal);font-family:'JetBrains Mono',monospace;min-width:32px}

/* ‚ïê‚ïê‚ïê OCR ‚ïê‚ïê‚ïê */
.ocr-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.ocr-preview{max-width:100%;border-radius:10px;margin-top:10px;border:1px solid rgba(255,255,255,.06);display:none}
.ocr-hint{font-size:11px;color:var(--teal);margin-top:8px;min-height:16px;font-weight:600}
@media(max-width:768px){.ocr-grid{grid-template-columns:1fr}}
.sb-nav{flex:1;padding:12px 10px;display:flex;flex-direction:column;gap:2px;overflow-y:auto}
.sb-section{font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);padding:10px 12px 4px}
.sb-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;background:none;border:none;color:var(--text2);font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;text-align:left;transition:background .15s,color .15s;width:100%}
.sb-item:hover{background:rgba(255,255,255,.04);color:var(--text)}
.sb-item.active{background:rgba(6,214,200,.08);color:var(--teal)}
.sb-item.active .sb-dot{background:var(--teal)}
.sb-item.locked{opacity:.45;cursor:not-allowed}
.sb-dot{width:6px;height:6px;border-radius:50%;background:var(--text3);flex-shrink:0;transition:background .15s}
.sb-lock{font-size:10px;margin-left:auto;opacity:.5}
.sb-footer{padding:12px 10px;border-top:1px solid rgba(255,255,255,.04)}
.user-pill{display:flex;align-items:center;gap:10px;padding:11px;border-radius:10px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);margin-bottom:8px}
.user-av{width:34px;height:34px;border-radius:8px;background:linear-gradient(135deg,var(--teal),var(--orange));display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;color:#fff;flex-shrink:0}
.user-info{min-width:0}
.user-name{font-size:12px;font-weight:700;color:var(--white);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.user-email{font-size:10px;color:var(--text3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.user-role{font-size:9px;color:var(--purple);font-weight:700;letter-spacing:.5px;text-transform:uppercase;margin-top:1px}
.btn-logout{width:100%;padding:9px;border-radius:8px;background:none;border:1px solid rgba(239,68,68,.15);color:rgba(239,68,68,.6);font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;transition:background .15s,color .15s}
.btn-logout:hover{background:rgba(239,68,68,.08);color:var(--red)}
.main{margin-left:256px;min-height:100vh;background:var(--navy)}
.topbar{background:var(--navy2);border-bottom:1px solid rgba(6,214,200,.06);padding:0 32px;height:60px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.topbar-title{font-size:14px;font-weight:800;color:var(--white);letter-spacing:.5px}
.topbar-badge{font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;padding:3px 10px;border-radius:100px;border:1px solid}
.topbar-badge.trial{color:var(--amber);background:rgba(245,158,11,.1);border-color:rgba(245,158,11,.25)}
.topbar-badge.basico{color:var(--text2);background:rgba(100,116,139,.1);border-color:rgba(100,116,139,.25)}
.topbar-badge.premium{color:var(--teal);background:rgba(6,214,200,.08);border-color:rgba(6,214,200,.2)}
.topbar-badge.superadmin{color:var(--purple);background:rgba(139,92,246,.1);border-color:rgba(139,92,246,.25)}
#menuToggle{display:none;background:none;border:none;cursor:pointer;color:var(--text);font-size:20px;padding:4px 8px;margin-right:10px}

/* ‚ïê‚ïê‚ïê TRIAL BANNER ‚ïê‚ïê‚ïê */
.trial-banner{background:linear-gradient(135deg,rgba(245,158,11,.12),rgba(249,115,22,.08));border-bottom:1px solid rgba(245,158,11,.15);padding:10px 32px;display:flex;align-items:center;justify-content:space-between;gap:16px}
.trial-banner.hidden{display:none}
.trial-banner-text{font-size:12px;color:var(--amber);font-weight:600}
.trial-banner-text strong{color:var(--orange)}

/* ‚ïê‚ïê‚ïê NOTIFICACIONES ‚ïê‚ïê‚ïê */
.notif-btn{position:relative;background:none;border:none;cursor:pointer;padding:8px;color:var(--text2);font-size:18px;transition:color .2s}
.notif-btn:hover{color:var(--teal)}
.notif-badge{position:absolute;top:4px;right:4px;min-width:16px;height:16px;border-radius:50%;background:var(--orange);color:#fff;font-size:9px;font-weight:800;display:flex;align-items:center;justify-content:center;line-height:1;padding:0 3px}
.notif-badge.hidden{display:none}
.notif-panel{position:absolute;top:62px;right:10px;width:340px;background:var(--navy2);border-radius:var(--r2);border:1px solid rgba(6,214,200,.12);box-shadow:0 8px 40px rgba(0,0,0,.5);z-index:300;display:none}
.notif-panel.show{display:block;animation:fadeUp .2s ease}
.notif-head{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.05);display:flex;justify-content:space-between;align-items:center}
.notif-head h3{font-size:12px;font-weight:800;color:var(--white)}
.notif-list{max-height:280px;overflow-y:auto}
.notif-item{padding:12px 18px;border-bottom:1px solid rgba(255,255,255,.04);display:flex;gap:12px;align-items:flex-start;transition:background .15s}
.notif-item:hover{background:rgba(255,255,255,.02)}
.notif-item.unread{background:rgba(6,214,200,.03)}
.notif-icon{font-size:17px;flex-shrink:0;margin-top:2px}
.notif-content p{font-size:12px;color:var(--text);line-height:1.5}
.notif-content time{font-size:10px;color:var(--text3);margin-top:2px;display:block}
.notif-empty{padding:24px;text-align:center;font-size:12px;color:var(--text3)}

/* ‚ïê‚ïê‚ïê P√ÅGINAS ‚ïê‚ïê‚ïê */
.page{padding:28px 32px}
.card{background:var(--navy2);border-radius:var(--r2);border:1px solid rgba(255,255,255,.05);box-shadow:0 2px 16px rgba(0,0,0,.3)}
.card-body{padding:22px}
.card-title{font-size:14px;font-weight:700;color:var(--text);margin-bottom:16px;display:flex;align-items:center;gap:8px;letter-spacing:.3px}
.kpi-row{display:flex;gap:14px;margin-bottom:22px;flex-wrap:wrap}
.kpi{flex:1;min-width:150px;background:var(--navy2);border-radius:var(--r2);padding:18px 20px;border:1px solid rgba(255,255,255,.05);position:relative;overflow:hidden;transition:transform .2s,border-color .2s}
.kpi:hover{transform:translateY(-2px);border-color:rgba(6,214,200,.15)}
.kpi::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px}
.kpi.k-teal::before{background:var(--teal)}.kpi.k-orange::before{background:var(--orange)}.kpi.k-amber::before{background:var(--amber)}.kpi.k-green::before{background:var(--green)}.kpi.k-gray::before{background:var(--text3)}.kpi.k-purple::before{background:var(--purple)}
.kpi-lbl{font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-bottom:6px}
.kpi-val{font-size:18px;font-weight:700;color:var(--white);font-family:'JetBrains Mono',monospace;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.kpi-val.pos{color:var(--teal)}.kpi-val.neg{color:var(--red)}
.charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
.chart-box{background:var(--navy2);border-radius:var(--r2);border:1px solid rgba(255,255,255,.05);padding:22px}
.chart-box-full{grid-column:1/-1}
.chart-label{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-bottom:18px;display:flex;align-items:center;gap:10px}
.chart-label span{color:var(--teal)}
.chart-label::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.05)}
.chart-container{position:relative;width:100%}
.tbl-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
table{width:100%;border-collapse:collapse;min-width:560px}
thead{background:rgba(6,214,200,.04);border-bottom:1px solid rgba(6,214,200,.1)}
th{padding:11px 16px;text-align:left;font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--teal);white-space:nowrap}
td{padding:11px 16px;font-size:13px;border-bottom:1px solid rgba(255,255,255,.04);color:var(--text)}
tr:hover td{background:rgba(255,255,255,.02)}
.f-lbl{display:block;font-size:10px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;color:var(--text3);margin-bottom:7px}
.inp{width:100%;padding:11px 14px;border-radius:var(--r);border:1.5px solid rgba(255,255,255,.07);background:rgba(255,255,255,.03);font-family:inherit;font-size:13px;color:var(--text);outline:none;transition:border-color .2s,box-shadow .2s}
.inp::placeholder{color:var(--text3)}
/* ‚úÖ FIX: select option dark */
select.inp,select.inp option{background:var(--navy3)!important;color:var(--text)!important}
.inp:focus{border-color:var(--teal);box-shadow:0 0 0 3px rgba(6,214,200,.08)}
.badge{display:inline-flex;align-items:center;padding:4px 12px;border-radius:100px;font-size:10px;font-weight:700;letter-spacing:.5px}
.badge-teal{background:rgba(6,214,200,.12);color:var(--teal);border:1px solid rgba(6,214,200,.2)}
.badge-amber{background:rgba(245,158,11,.1);color:var(--amber);border:1px solid rgba(245,158,11,.2)}
.badge-gray{background:rgba(100,116,139,.1);color:var(--text2);border:1px solid rgba(100,116,139,.2)}
.badge-red{background:rgba(239,68,68,.1);color:var(--red);border:1px solid rgba(239,68,68,.2)}
.badge-purple{background:rgba(139,92,246,.1);color:var(--purple);border:1px solid rgba(139,92,246,.2)}
.badge-green{background:rgba(16,185,129,.1);color:var(--green);border:1px solid rgba(16,185,129,.2)}
.estado-sel{padding:7px 12px;border-radius:8px;border:1.5px solid rgba(255,255,255,.07);background:var(--navy3);font-family:inherit;font-size:11px;font-weight:700;color:var(--text);cursor:pointer;min-width:140px}
.estado-sel:focus{outline:none;border-color:var(--teal)}
.sec-title{font-size:20px;font-weight:800;color:var(--white);margin-bottom:22px;display:flex;align-items:center;gap:14px;letter-spacing:-.3px}
.sec-title-tag{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--orange);background:rgba(249,115,22,.1);padding:4px 12px;border-radius:100px;border:1px solid rgba(249,115,22,.2)}
.sec-title::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.05)}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .3s;z-index:150}
.overlay.on{opacity:1;pointer-events:auto}
.logo-preview{max-width:110px;border-radius:8px;margin-top:10px;display:block}
.mono{font-family:'JetBrains Mono',monospace}
.filter-bar{background:var(--navy2);border-radius:var(--r2);border:1px solid rgba(255,255,255,.05);padding:14px 20px;margin-bottom:20px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
@keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:.4}}
.live-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--teal);animation:pulse-dot 2s ease infinite}
.filtro-on{box-shadow:0 0 0 2px var(--teal)!important}

/* ‚ïê‚ïê‚ïê SUPERADMIN ‚ïê‚ïê‚ïê */
.admin-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-bottom:24px}
.empresa-card{background:var(--navy2);border-radius:var(--r2);border:1px solid rgba(255,255,255,.06);padding:20px;transition:border-color .2s,transform .2s}
.empresa-card:hover{border-color:rgba(6,214,200,.15);transform:translateY(-2px)}
.empresa-card-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px}
.empresa-name{font-size:14px;font-weight:800;color:var(--white);margin-bottom:3px}
.empresa-id{font-size:10px;color:var(--text3);font-family:'JetBrains Mono',monospace;cursor:pointer}
.empresa-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.estat{background:var(--navy3);border-radius:8px;padding:10px 12px}
.estat-lbl{font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text3);margin-bottom:3px}
.estat-val{font-size:14px;font-weight:700;color:var(--white);font-family:'JetBrains Mono',monospace}
.empresa-actions{display:flex;gap:8px}

/* ‚ïê‚ïê‚ïê LOGS ‚ïê‚ïê‚ïê */
.log-item{padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.04);display:flex;gap:14px;align-items:flex-start}
.log-icon{font-size:16px;flex-shrink:0;margin-top:2px}
.log-content p{font-size:12px;color:var(--text);line-height:1.5}
.log-content .log-user{font-weight:700;color:var(--teal)}
.log-content time{font-size:10px;color:var(--text3);margin-top:2px;display:block}
.log-list{max-height:420px;overflow-y:auto}

/* ‚ïê‚ïê‚ïê ONBOARDING ‚ïê‚ïê‚ïê */
.onboarding-card{background:linear-gradient(135deg,var(--navy2),var(--navy3));border:1px solid rgba(6,214,200,.12);border-radius:var(--r2);padding:22px;margin-bottom:20px}
.onboarding-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.onboarding-title{font-size:14px;font-weight:800;color:var(--white)}
.onboarding-progress{font-size:12px;font-weight:700;color:var(--teal);font-family:'JetBrains Mono',monospace}
.onboarding-bar{height:4px;background:rgba(255,255,255,.06);border-radius:2px;margin-bottom:18px;overflow:hidden}
.onboarding-bar-fill{height:100%;background:linear-gradient(90deg,var(--teal),var(--orange));border-radius:2px;transition:width .5s ease}
.onboarding-steps{display:flex;flex-direction:column;gap:10px}
.onboarding-step{display:flex;gap:12px;align-items:flex-start;padding:10px 14px;border-radius:8px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.04);transition:all .2s}
.onboarding-step.done{background:rgba(6,214,200,.05);border-color:rgba(6,214,200,.15)}
.onboarding-step strong{font-size:13px;color:var(--white);display:block;margin-bottom:2px}
.onboarding-step p{font-size:11px;color:var(--text3);margin:0}
.onboarding-check{font-size:16px;flex-shrink:0;margin-top:1px}

/* ‚ïê‚ïê‚ïê AYUDA CENTRO ‚ïê‚ïê‚ïê */
#helpModal{position:fixed;inset:0;z-index:10000;display:none;align-items:center;justify-content:center;padding:20px}
.help-overlay{position:absolute;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px)}
.help-content{position:relative;background:var(--navy2);border-radius:var(--r2);border:1px solid rgba(6,214,200,.15);max-width:520px;width:100%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.6);animation:fadeUp .3s ease}
.help-header{padding:22px 28px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:var(--navy2);z-index:1}
.help-header h3{font-size:16px;font-weight:800;color:var(--white)}
.btn-close-help{background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.2);color:var(--red);width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .2s}
.btn-close-help:hover{background:rgba(239,68,68,.2);transform:rotate(90deg)}
.help-body{padding:22px 28px}
.help-section{margin-bottom:24px;padding-bottom:24px;border-bottom:1px solid rgba(255,255,255,.05)}
.help-section:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
.help-section h4{font-size:13px;font-weight:800;color:var(--teal);margin-bottom:10px}
.help-section p{font-size:13px;color:var(--text2);line-height:1.7;margin-bottom:8px}
.help-section code{background:rgba(6,214,200,.08);color:var(--teal3);padding:2px 8px;border-radius:5px;font-family:'JetBrains Mono',monospace;font-size:12px}
.help-btn-wa{display:block;padding:11px 18px;border-radius:var(--r);background:#25d366;color:#fff;text-decoration:none;font-weight:700;font-size:13px;text-align:center;margin-bottom:8px;transition:background .2s}
.help-btn-wa:hover{background:#20ba5a}
.help-btn-email{display:block;padding:11px 18px;border-radius:var(--r);background:rgba(249,115,22,.12);color:var(--orange);text-decoration:none;font-weight:700;font-size:13px;text-align:center;border:1px solid rgba(249,115,22,.2);transition:background .2s}
.help-btn-email:hover{background:rgba(249,115,22,.2)}

@media(max-width:900px){.charts-grid{grid-template-columns:1fr}.chart-box-full{grid-column:auto}}
@media(max-width:768px){
  #menuToggle{display:block}.sidebar{left:-265px;transition:left .3s}.sidebar.open{left:0}.main{margin-left:0}.topbar{padding:0 14px}.page{padding:18px 14px}.kpi-row{gap:8px}.kpi{min-width:calc(50% - 4px);padding:14px}
  .trial-banner{flex-direction:column;gap:8px;text-align:center}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê ORBES ANIMADOS (fondo) ‚ïê‚ïê‚ïê -->
<div class="bg-orb bg-orb-1"></div>
<div class="bg-orb bg-orb-2"></div>
<div class="bg-orb bg-orb-3"></div>

<!-- ‚ïê‚ïê‚ïê SUSPENDED ‚ïê‚ïê‚ïê -->
<div id="suspendedScreen" style="display:none;min-height:100vh;align-items:center;justify-content:center;padding:20px">
  <div class="suspended-card">
    <div class="suspended-icon">üîí</div>
    <div class="suspended-title">Acceso Restringido</div>
    <div class="suspended-text" id="suspendedMsg">Tu cuenta ha sido suspendida o tu plan ha vencido.</div>
    <div style="margin-top:28px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <a href="https://wa.me/573005541411?text=Necesito reactivar mi cuenta GESTIUM" target="_blank" class="btn btn-teal btn-sm">üì± WhatsApp</a>
      <button onclick="window._doSignOut()" class="btn btn-navy btn-sm">Cerrar sesi√≥n</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê -->
<div id="loginScreen">
  <div class="login-grid-bg"></div>
  <div class="login-deco">
    <div class="login-eyebrow">GESTIUM ¬∑ Inteligencia Operativa</div>
    <div class="login-headline">Control total<br>de tu <em>operaci√≥n</em><br>en tiempo real.</div>
    <div class="login-tagline">Cotizaciones, finanzas y dashboards en un solo ecosistema. Conectado. Preciso. Escalable.</div>
    <div class="login-chips">
      <div class="login-chip">üìÑ PDF autom√°tico</div>
      <div class="login-chip">üìä Dashboard en vivo</div>
      <div class="login-chip">üí∞ Control financiero</div>
      <div class="login-chip">üë• Multi-usuario & roles</div>
      <div class="login-chip">üîí Firebase seguro</div>
      <div class="login-chip">üóí Auditor√≠a completa</div>
    </div>
    <div style="display:flex;gap:10px;justify-content:center;margin-top:24px;flex-wrap:wrap">
      <a href="https://www.facebook.com/share/18DSCn8qA3/" target="_blank" rel="noopener noreferrer" style="color:var(--text3);font-size:11px;text-decoration:none;display:flex;align-items:center;gap:4px">üìò Facebook</a>
      <a href="https://www.instagram.com/gestium_inteligencia_operativa?igsh=emJtamcyZWdmMW15" target="_blank" rel="noopener noreferrer" style="color:var(--text3);font-size:11px;text-decoration:none;display:flex;align-items:center;gap:4px">üì∏ Instagram</a>
      <a href="https://www.linkedin.com/company/GestiumInteligenciaOperativa" target="_blank" style="color:var(--text3);font-size:11px;text-decoration:none;display:flex;align-items:center;gap:4px">üíº LinkedIn</a>
    </div>
  </div>
  <div class="login-panel">
    <div class="login-logo-text">GESTIUM <span>¬∑</span></div>
    <div class="login-sub-text">Inteligencia Operativa</div>
    <div style="margin-bottom:16px"><label class="f-label">Correo electr√≥nico</label><input id="loginEmail" type="email" class="f-input" placeholder="tu@empresa.com" autocomplete="username"></div>
    <div style="margin-bottom:10px"><label class="f-label">Contrase√±a</label>
      <div class="pw-wrap"><input id="loginPassword" type="password" class="f-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"><span id="togglePassword" class="pw-eye">üëÅ</span></div>
    </div>
    <div class="login-row">
      <label class="rem-label"><input id="remember" type="checkbox"> Recordarme</label>
      <button id="resetBtn" class="btn btn-ghost btn-sm" type="button">Recuperar acceso</button>
    </div>
    <button id="loginBtn" class="btn btn-primary" type="button"><span id="loginText">Iniciar sesi√≥n</span><span id="loginSpinner" style="display:none">‚åõ</span></button>
    <p id="loginMessage" class="login-msg"></p>
    <div class="login-footer">¬øSin cuenta? <button id="showRegister" class="btn btn-ghost" style="display:inline;padding:0;margin-left:5px" type="button">Crear empresa</button></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê REGISTRO ‚ïê‚ïê‚ïê -->
<div id="registerScreen">
  <div class="reg-card">
    <div class="reg-head"><h2>Crear cuenta</h2><p>Completa la informaci√≥n de tu empresa y usuario administrador</p></div>
    <div class="reg-body">
      <div class="mode-tgl"><button class="mode-btn on" id="modeNuevaBtn" type="button">Nueva empresa</button><button class="mode-btn" id="modeExistenteBtn" type="button">Unirme a empresa</button></div>
      <input id="regModoEmpresa" type="hidden" value="nueva">
      <div id="bloqueEmpresaExistente" style="display:none">
        <div class="reg-sep">üè¢ Datos de acceso</div>
        <input id="regEmpresaExistente" class="ri" type="text" placeholder="ID de empresa (pide al administrador)">
        <input id="regTokenInvitacion" class="ri" type="text" placeholder="Token de invitaci√≥n (opcional)">
      </div>
      <div id="bloqueNuevaEmpresa">
        <div class="reg-sep">üè¢ Datos de la empresa</div>
        <input id="regEmpresa" class="ri" type="text" placeholder="Nombre de la empresa *">
        <div class="reg-2"><input id="regNitEmpresa" class="ri" type="text" placeholder="NIT / RUT"><input id="regTelefonoEmpresa" class="ri" type="tel" placeholder="Tel√©fono empresa"></div>
        <input id="regDireccionEmpresa" class="ri" type="text" placeholder="Direcci√≥n">
        <div class="reg-2"><input id="regCiudadEmpresa" class="ri" type="text" placeholder="Ciudad"><input id="regPaisEmpresa" class="ri" type="text" placeholder="Pa√≠s" value="Colombia"></div>
        <input id="regWebEmpresa" class="ri" type="text" placeholder="Sitio web (opcional)">
        <input id="regEmailEmpresa" class="ri" type="email" placeholder="Email de contacto empresa">
        <div class="reg-sep">üì¶ Plan inicial</div>
        <select id="regPlan" class="ri"><option value="trial">üéÅ Trial (7 d√≠as gratis)</option><option value="basico">üìã B√°sico</option><option value="premium">‚≠ê Premium</option></select>
      </div>
      <div class="reg-sep">üë§ Administrador</div>
      <div class="reg-2"><input id="regNombreUsuario" class="ri" type="text" placeholder="Nombre *"><input id="regApellidoUsuario" class="ri" type="text" placeholder="Apellido"></div>
      <input id="regCargoUsuario" class="ri" type="text" placeholder="Cargo (ej: Gerente)">
      <div class="reg-2"><input id="regCelularUsuario" class="ri" type="tel" placeholder="Celular *"><input id="regTelefonoUsuario" class="ri" type="tel" placeholder="Tel√©fono fijo"></div>
      <div class="reg-sep">üîê Acceso al sistema</div>
      <input id="regEmail" class="ri" type="email" placeholder="Correo electr√≥nico *">
      <input id="regPassword" class="ri" type="password" placeholder="Contrase√±a (m√≠n. 6 caracteres) *">
      <button id="registerBtn" class="btn btn-primary" style="margin-top:8px" type="button">Crear Cuenta</button>
      <div style="text-align:center;margin-top:12px"><button id="backToLogin" class="btn btn-ghost" type="button">‚Üê Volver al login</button></div>
      <p id="registerMessage" class="reg-msg"></p>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê -->
<div id="app">
  <aside class="sidebar" id="sidebar">
    <div class="sb-stripe"></div>
    <div class="sb-top">
      <div class="sb-brand">Gestium IO</div>
      <div class="sb-company" id="sidebarEmpresaNombre">‚Äî</div>
      <div class="plan-pill" id="sidebarPlanPill">‚Äî</div>
    </div>
    <nav class="sb-nav" id="sbNav"></nav>
    <div class="sb-footer">
      <div class="user-pill">
        <div class="user-av" id="userAvatar">?</div>
        <div class="user-info">
          <div class="user-name" id="sidebarUserName">‚Äî</div>
          <div class="user-email" id="sidebarUserEmail">‚Äî</div>
          <div class="user-role" id="sidebarUserRole">‚Äî</div>
        </div>
      </div>
      <button id="sidebarLogout" class="btn-logout">‚èª Cerrar sesi√≥n</button>
    </div>
  </aside>
  <div id="overlay" class="overlay"></div>
  <div class="main">
    <div class="trial-banner hidden" id="trialBanner">
      <div class="trial-banner-text">üéÅ Per√≠odo de prueba ‚Äî <strong><span id="trialDaysLeft">7</span> d√≠as restantes</strong></div>
      <a href="https://wa.me/573005541411?text=Quiero actualizar mi plan GESTIUM" target="_blank" class="btn btn-orange btn-sm" style="white-space:nowrap;width:auto">Actualizar plan ‚Üí</a>
    </div>
    <header class="topbar">
      <div style="display:flex;align-items:center;gap:12px">
        <button id="menuToggle">‚ò∞</button>
        <div class="topbar-title" id="topbarTitle">GESTIUM</div>
        <div class="live-dot" style="margin-left:4px" title="En tiempo real"></div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <span class="topbar-badge" id="topbarBadge">‚Äî</span>
        <button class="notif-btn" id="notifBtn" title="Notificaciones">üîî<span class="notif-badge hidden" id="notifCount">0</span></button>
        <button id="helpBtn" class="btn btn-navy btn-sm" type="button" title="Centro de ayuda">‚ùì</button>
        <button id="btnUploadLogo" class="btn btn-navy btn-sm" type="button">‚¨Ü Logo</button>
        <input type="file" id="logoInput" accept="image/*" style="display:none">
      </div>
    </header>
    <div class="notif-panel" id="notifPanel">
      <div class="notif-head"><h3>Notificaciones</h3><button id="btnMarcarLeidas" class="btn btn-ghost" style="font-size:11px;padding:3px 0">Marcar le√≠das</button></div>
      <div class="notif-list" id="notifList"><div class="notif-empty">Sin notificaciones</div></div>
    </div>

    <!-- ONBOARDING -->
    <div id="onboardingChecklist" style="padding:20px 32px 0;display:none"></div>

    <!-- M√ìDULO COTIZACIONES -->
    <div id="moduloCotizaciones" class="page" style="display:none">
      <div class="sec-title">Cotizaciones <span class="sec-title-tag">GESTIUM</span></div>
      <div class="card" style="margin-bottom:18px"><div class="card-body">
        <div class="card-title">üë§ Gesti√≥n de Clientes</div>
        <div style="display:grid;grid-template-columns:1fr auto;gap:10px;margin-bottom:14px;align-items:flex-end">
          <div><label class="f-lbl">Nuevo cliente</label><input id="cliente" class="inp" type="text" placeholder="Nombre del cliente"></div>
          <button id="guardarClienteBtn" class="btn btn-teal btn-sm" type="button">+ Guardar</button>
        </div>
        <div><label class="f-lbl">Seleccionar cliente existente</label><select id="listaClientes" class="inp"><option value="">-- Seleccionar --</option></select></div>
      </div></div>
      <div class="card" style="margin-bottom:18px"><div class="card-body">
        <div class="card-title">üìê Par√°metros de Cotizaci√≥n</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;margin-bottom:16px">
          <div><label class="f-lbl">Altura (cm)</label><input id="altura" class="inp" type="number" value="38"></div>
          <div><label class="f-lbl">Precio / m¬≥ (COP)</label><input id="precio" class="inp" type="number" value="235000"></div>
          <div><label class="f-lbl">IVA (%)</label><input id="iva" class="inp" type="number" value="19"></div>
        </div>
        <div style="margin-bottom:16px"><label class="f-lbl">Medidas ‚Äî formato: cant-ancho*largo (ej: 2-180*100)</label><textarea id="medidas" class="inp" style="min-height:110px;resize:vertical;font-family:'JetBrains Mono',monospace;font-size:13px" placeholder="2-180*100&#10;3-200x100&#10;1-150*80"></textarea></div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button id="generarBtn" class="btn btn-primary" type="button" style="width:auto">üìÑ Generar Cotizaci√≥n PDF</button>
          <button id="generarReporteBtn" class="btn btn-teal btn-sm" type="button">üìä Reporte Mensual</button>
          <button id="exportarCSVBtn" class="btn btn-navy btn-sm" type="button">üì• Exportar CSV</button>
        </div>
      </div></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px">
        <button id="backupBtn" class="btn btn-sm btn-orange" type="button">üíæ Backup JSON</button>
        <input id="restoreInput" type="file" accept=".json" style="display:none">
        <button id="restoreBtn" class="btn btn-sm btn-navy" type="button">üìÇ Restaurar</button>
      </div>
      <img id="logoPreview" class="logo-preview" style="display:none">
      <div class="card" style="margin-top:22px"><div class="card-body">
        <div class="card-title">üóÇ Cotizaciones Registradas <span style="font-size:10px;color:var(--text3);font-weight:400;margin-left:6px">(√∫ltimas 30)</span></div>
        <div class="tbl-wrap"><table id="tablaCotizaciones"><thead><tr><th>N¬∞</th><th>Cliente</th><th>Fecha</th><th>Total</th><th>Estado</th><th>Acciones</th></tr></thead><tbody></tbody></table></div>
        <div style="text-align:center;margin-top:14px"><button id="btnCargarMas" class="btn btn-navy btn-sm" style="display:none" type="button">Cargar m√°s ‚Üí</button></div>
      </div></div>
    </div>

    <!-- M√ìDULO DASHBOARD -->
    <div id="moduloDashboard" class="page" style="display:none">
      <div class="sec-title">Dashboard <span class="sec-title-tag">TIEMPO REAL</span></div>
      <div class="filter-bar">
        <input id="mesReporte" type="month" class="inp" style="width:auto">
        <select id="clienteFiltro" class="inp" style="width:auto;min-width:180px"><option value="">‚Äî Todos los clientes ‚Äî</option></select>
        <button id="actualizarDashboard" class="btn btn-primary btn-sm" type="button">‚Ü∫ Actualizar</button>
        <button id="btnLimpiarFiltros" class="btn btn-sm btn-navy" type="button">‚úï Limpiar</button>
      </div>
      <div class="kpi-row">
        <div class="kpi k-teal"><div class="kpi-lbl">Total Cotizado</div><div class="kpi-val mono" id="kpiCotizado">‚Äî</div></div>
        <div class="kpi k-orange"><div class="kpi-lbl">Ventas Confirmadas</div><div class="kpi-val pos" id="kpiVentas">‚Äî</div></div>
        <div class="kpi k-amber"><div class="kpi-lbl">% Confirmaci√≥n</div><div class="kpi-val mono" id="kpiConversion">‚Äî</div></div>
        <div class="kpi k-gray"><div class="kpi-lbl">Cotizaciones</div><div class="kpi-val mono" id="kpiCantidad">‚Äî</div></div>
        <div class="kpi k-green"><div class="kpi-lbl">Ticket Promedio</div><div class="kpi-val mono" id="kpiPromedio">‚Äî</div></div>
      </div>
      <div class="charts-grid">
        <div class="chart-box chart-box-full"><div class="chart-label"><span>‚óè</span> Ventas por d√≠a</div><div class="chart-container" style="height:280px"><canvas id="graficoVentas"></canvas></div></div>
        <div class="chart-box"><div class="chart-label"><span>‚óè</span> Por cliente</div><div class="chart-container" style="height:270px"><canvas id="graficoClientes"></canvas></div></div>
        <div class="chart-box"><div class="chart-label"><span>‚óè</span> Por estado</div><div class="chart-container" style="height:270px"><canvas id="graficoEstados"></canvas></div></div>
      </div>
    </div>

    <!-- M√ìDULO FINANCIERO -->
    <div id="moduloFinanciero" class="page" style="display:none">
      <div class="sec-title">Finanzas <span class="sec-title-tag">PREMIUM</span></div>
      <div class="card" style="margin-bottom:18px"><div class="card-body">
        <div class="card-title">üìã Registrar Costo / Gasto</div>
        <div style="display:flex;flex-wrap:wrap;gap:12px;align-items:flex-end">
          <div><label class="f-lbl">Fecha</label><input type="date" id="gastoFecha" class="inp" style="width:auto"></div>
          <div><label class="f-lbl">Cliente</label><select id="gastoCliente" class="inp" style="min-width:155px"><option value="">Seleccionar</option></select></div>
          <div><label class="f-lbl">Categor√≠a</label><select id="gastoCategoria" class="inp"><option>Materia Prima</option><option>Transporte</option><option>N√≥mina</option><option>Servicios</option><option>Otros</option></select></div>
          <div><label class="f-lbl">Valor (COP)</label><input type="number" id="gastoValor" class="inp" placeholder="0" style="width:140px"></div>
          <div style="flex:1;min-width:160px"><label class="f-lbl">Descripci√≥n</label><input type="text" id="gastoDescripcion" class="inp" placeholder="Descripci√≥n del gasto"></div>
          <button id="guardarGastoBtn" class="btn btn-teal btn-sm" type="button">+ Registrar</button>
        </div>
      </div></div>
      <div class="card"><div class="card-body">
        <div class="card-title">üì¶ Costos Registrados</div>
        <div class="tbl-wrap"><table id="tablaGastos"><thead><tr><th>Fecha</th><th>Cliente</th><th>Categor√≠a</th><th>Descripci√≥n</th><th>Valor</th><th></th></tr></thead><tbody></tbody></table></div>
      </div></div>
    </div>

    <!-- M√ìDULO INVITACIONES -->
    <div id="moduloInvitaciones" class="page" style="display:none">
      <div class="sec-title">Invitaciones <span class="sec-title-tag">EQUIPO</span></div>
      <div class="card" style="margin-bottom:18px"><div class="card-body">
        <div class="card-title">‚úâÔ∏è Generar Invitaci√≥n</div>
        <div style="display:flex;flex-wrap:wrap;gap:12px;align-items:flex-end">
          <div><label class="f-lbl">Email destino (opcional)</label><input type="email" id="invEmail" class="inp" placeholder="colaborador@empresa.com" style="min-width:220px"></div>
          <div><label class="f-lbl">Rol del invitado</label><select id="invRol" class="inp" style="width:auto"><option value="vendedor">Vendedor</option><option value="contabilidad">Contabilidad</option><option value="admin">Administrador</option></select></div>
          <button id="crearInvBtn" class="btn btn-teal btn-sm" type="button">+ Crear Invitaci√≥n</button>
        </div>
        <div id="invResult" style="display:none;margin-top:14px;padding:12px 16px;background:rgba(6,214,200,.06);border:1px solid rgba(6,214,200,.2);border-radius:var(--r);font-size:12px;font-family:'JetBrains Mono',monospace;word-break:break-all;color:var(--teal3)"></div>
      </div></div>
      <div class="card"><div class="card-body">
        <div class="card-title">üîë Invitaciones Activas</div>
        <div class="tbl-wrap"><table id="tablaInvitaciones"><thead><tr><th>Token</th><th>Rol</th><th>Email</th><th>Estado</th></tr></thead><tbody></tbody></table></div>
      </div></div>
    </div>

    <!-- M√ìDULO USUARIOS -->
    <div id="moduloUsuarios" class="page" style="display:none">
      <div class="sec-title">Usuarios <span class="sec-title-tag">EMPRESA</span></div>
      <div class="card"><div class="card-body">
        <div class="card-title">üë• Usuarios de la Empresa</div>
        <div class="tbl-wrap"><table id="tablaUsuarios"><thead><tr><th>Nombre</th><th>Email</th><th>Cargo</th><th>Rol</th><th>Estado</th><th>ID Empresa</th></tr></thead><tbody></tbody></table></div>
      </div></div>
    </div>

    <!-- M√ìDULO LOGS -->
    <div id="moduloLogs" class="page" style="display:none">
      <div class="sec-title">Auditor√≠a <span class="sec-title-tag">TIEMPO REAL</span></div>
      <div class="card"><div class="card-body">
        <div class="card-title">üóí Registro de Actividad <div class="live-dot" style="margin-left:4px"></div></div>
        <div class="log-list" id="logList"><div style="padding:20px;text-align:center;color:var(--text3);font-size:13px">Cargando...</div></div>
      </div></div>
    </div>

    <!-- M√ìDULO SUPERADMIN -->
    <div id="moduloSuperadmin" class="page" style="display:none">
      <div class="sec-title">Superadmin <span class="sec-title-tag">CONTROL TOTAL</span></div>
      <div class="kpi-row">
        <div class="kpi k-teal"><div class="kpi-lbl">Total Empresas</div><div class="kpi-val mono" id="saKpiTotal">‚Äî</div></div>
        <div class="kpi k-green"><div class="kpi-lbl">Activas</div><div class="kpi-val pos" id="saKpiActivas">‚Äî</div></div>
        <div class="kpi k-amber"><div class="kpi-lbl">En Trial</div><div class="kpi-val mono" id="saKpiTrial">‚Äî</div></div>
        <div class="kpi k-orange"><div class="kpi-lbl">Premium</div><div class="kpi-val mono" id="saKpiPremium">‚Äî</div></div>
        <div class="kpi k-purple"><div class="kpi-lbl">MRR Estimado</div><div class="kpi-val mono" id="saKpiMrr">‚Äî</div></div>
      </div>
      <div class="admin-grid" id="adminGrid"></div>
      <div class="card"><div class="card-body">
        <div class="card-title">üî¥ Errores del Sistema</div>
        <div class="tbl-wrap"><table id="tablaErrores"><thead><tr><th>Fecha</th><th>Tipo</th><th>Mensaje</th><th>Contexto</th></tr></thead><tbody></tbody></table></div>
      </div></div>
    </div>

    <!-- M√ìDULO OCR -->
    <div id="moduloOCR" class="page" style="display:none">
      <div class="sec-title">OCR Medidas <span class="sec-title-tag">SUPER PREMIUM</span></div>
      <div class="card"><div class="card-body">
        <p style="font-size:13px;color:var(--text2);margin-bottom:18px;line-height:1.7">
          Sube una foto o escaneo con las medidas escritas. La IA extrae el texto autom√°ticamente y lo transfiere al cotizador.
        </p>
        <div class="ocr-grid">
          <div>
            <div class="card-title">üì∑ Imagen</div>
            <label class="f-lbl">Subir imagen (foto / escaneo)</label>
            <input type="file" id="ocrImageInput" accept="image/*" class="inp">
            <img id="ocrPreview" class="ocr-preview" alt="Vista previa">
            <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
              <button id="ocrLeerBtn" class="btn btn-primary btn-sm" type="button" style="width:auto">üîç Leer con IA</button>
              <button id="ocrLimpiarBtn" class="btn btn-navy btn-sm" type="button">‚úï Limpiar</button>
            </div>
            <div id="ocrHint" class="ocr-hint"></div>
          </div>
          <div>
            <div class="card-title">üìù Texto detectado</div>
            <label class="f-lbl">Texto extra√≠do (editable)</label>
            <textarea id="ocrTexto" class="inp" style="min-height:160px;font-family:'JetBrains Mono',monospace;font-size:12px;resize:vertical" placeholder="El texto de medidas aparecer√° aqu√≠&#10;&#10;Formato esperado:&#10;2-180*100&#10;3-200x100&#10;1-150*80"></textarea>
            <div style="margin-top:12px">
              <button id="ocrUsarBtn" class="btn btn-teal" type="button" style="width:100%">‚úì Usar medidas en Cotizador</button>
            </div>
          </div>
        </div>
        <div style="margin-top:20px;padding:14px 16px;background:rgba(6,214,200,.05);border:1px solid rgba(6,214,200,.12);border-radius:var(--r)">
          <div style="font-size:11px;font-weight:700;color:var(--teal);margin-bottom:6px;letter-spacing:.5px">üí° FORMATOS SOPORTADOS</div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text2);line-height:2">
            <span style="color:var(--teal)">2-180*100</span> ‚Üí 2 piezas de 180√ó100cm &nbsp;|&nbsp;
            <span style="color:var(--teal)">3-200x100</span> ‚Üí 3 piezas de 200√ó100cm &nbsp;|&nbsp;
            <span style="color:var(--teal)">150*80</span> ‚Üí 1 pieza de 150√ó80cm
          </div>
        </div>
      </div></div>
    </div>

    <!-- M√ìDULO CONTABILIDAD -->
    <div id="moduloContabilidad" class="page" style="display:none">
      <div class="sec-title">Contabilidad <span class="sec-title-tag">SUPER PREMIUM</span></div>

      <!-- Selector de mes -->
      <div class="filter-bar" style="margin-bottom:20px">
        <input id="mesContab" type="month" class="inp" style="width:auto">
        <button id="actualizarContab" class="btn btn-primary btn-sm" type="button">‚Ü∫ Actualizar</button>
        <button id="btnVerificarAlertas" class="btn btn-orange btn-sm" type="button">üîî Verificar Alertas</button>
        <button id="btnPreCierre" class="btn btn-teal btn-sm" type="button">‚úÖ Pre-Cierre</button>
        <span id="contabLoading" style="display:none;font-size:12px;color:var(--teal)">‚åõ Calculando...</span>
      </div>

      <!-- TABS -->
      <div class="contab-tabs">
        <button class="contab-tab active" data-tab="resumen">üìä Resumen Ejecutivo</button>
        <button class="contab-tab" data-tab="er">üìà Estado Resultados</button>
        <button class="contab-tab" data-tab="balance">‚öñÔ∏è Balance General</button>
        <button class="contab-tab" data-tab="flujo">üíß Flujo de Caja</button>
        <button class="contab-tab" data-tab="impuestos">üèõ Impuestos</button>
        <button class="contab-tab" data-tab="cxc">üìã CxC / CxP</button>
        <button class="contab-tab" data-tab="rentabilidad">üíé Rentabilidad</button>
        <button class="contab-tab" data-tab="riesgo">üéØ Riesgo</button>
        <button class="contab-tab" data-tab="libro">üìò Libro Diario</button>
        <button class="contab-tab" data-tab="simulador">üîÆ Simulador</button>
      </div>

      <!-- RESUMEN EJECUTIVO -->
      <div id="tab-resumen" class="contab-section active">
        <div class="kpi-row" id="contabKpis"></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
          <div class="card"><div class="card-body">
            <div class="card-title">üìà Estado de Resultados</div>
            <div id="contabER"></div>
          </div></div>
          <div>
            <div class="card" style="margin-bottom:16px"><div class="card-body">
              <div class="card-title">üíß Flujo de Caja ‚Äî Mes</div>
              <div id="contabFC"></div>
            </div></div>
            <div class="card"><div class="card-body">
              <div class="card-title">üèõ Obligaciones Tributarias</div>
              <div id="contabImp"></div>
            </div></div>
          </div>
        </div>
      </div>

      <!-- ESTADO DE RESULTADOS -->
      <div id="tab-er" class="contab-section">
        <div class="card"><div class="card-body">
          <div class="card-title">üìà Estado de Resultados ‚Äî Detalle</div>
          <div id="contabERDetalle"></div>
        </div></div>
      </div>

      <!-- BALANCE GENERAL -->
      <div id="tab-balance" class="contab-section">
        <div class="card"><div class="card-body">
          <div class="card-title">‚öñÔ∏è Balance General</div>
          <div id="contabBalance"></div>
        </div></div>
      </div>

      <!-- FLUJO DE CAJA + PREDICTIVO -->
      <div id="tab-flujo" class="contab-section">
        <div class="card" style="margin-bottom:16px"><div class="card-body">
          <div class="card-title">üíß Flujo de Caja Real ‚Äî Mes</div>
          <div id="contabFCDetalle"></div>
        </div></div>
        <div class="card"><div class="card-body">
          <div class="card-title">üîÆ Proyecci√≥n de Flujo 30/60/90 d√≠as <div class="live-dot" style="margin-left:4px;display:inline-block"></div></div>
          <div id="contabFCPred"></div>
        </div></div>
      </div>

      <!-- IMPUESTOS -->
      <div id="tab-impuestos" class="contab-section">
        <div class="card"><div class="card-body">
          <div class="card-title">üèõ Resumen de Impuestos</div>
          <div id="contabImpDetalle"></div>
          <div style="margin-top:14px;padding:12px;background:rgba(245,158,11,.06);border-radius:8px;border:1px solid rgba(245,158,11,.15)">
            <div style="font-size:11px;font-weight:700;color:var(--amber);margin-bottom:4px">Recordatorio</div>
            <div style="font-size:12px;color:var(--text2)">IVA: declarar √∫ltimo d√≠a h√°bil del mes siguiente ¬∑ Retenciones: 10 del mes siguiente ¬∑ ICA: seg√∫n municipio</div>
          </div>
        </div></div>
      </div>

      <!-- CxC / CxP -->
      <div id="tab-cxc" class="contab-section">
        <div class="card"><div class="card-body">
          <div class="card-title">üìã Cuentas por Cobrar y por Pagar</div>
          <div id="contabCxC"></div>
        </div></div>
      </div>

      <!-- RENTABILIDAD POR CLIENTE -->
      <div id="tab-rentabilidad" class="contab-section">
        <div class="card"><div class="card-body">
          <div class="card-title">üíé Rentabilidad por Cliente</div>
          <div class="tbl-wrap" id="contabRent"></div>
        </div></div>
      </div>

      <!-- AN√ÅLISIS DE RIESGO -->
      <div id="tab-riesgo" class="contab-section">
        <div class="card"><div class="card-body">
          <div class="card-title">üéØ Score de Riesgo por Cliente</div>
          <div class="tbl-wrap" id="contabRiesgo"></div>
        </div></div>
      </div>

      <!-- LIBRO DIARIO -->
      <div id="tab-libro" class="contab-section">
        <div class="card" style="margin-bottom:16px"><div class="card-body">
          <div class="card-title">üìò Crear Asiento Manual</div>
          <div style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:12px;align-items:flex-end">
            <div><label class="f-lbl">Fecha</label><input type="date" id="asientoFecha" class="inp" style="width:auto"></div>
            <div style="flex:1;min-width:220px"><label class="f-lbl">Descripci√≥n</label><input type="text" id="asientoDesc" class="inp" placeholder="Descripci√≥n del asiento"></div>
            <div><label class="f-lbl">Tercero</label><select id="asientoTercero" class="inp" style="min-width:140px"><option value="">Seleccionar cliente</option></select></div>
          </div>
          <div id="asientoLineas" style="margin-bottom:12px">
            <div class="asiento-linea" style="display:grid;grid-template-columns:130px 1fr 90px 120px auto;gap:8px;margin-bottom:6px;align-items:center">
              <select class="inp lin-cuenta" style="font-size:11px"><option value="">Cuenta</option></select>
              <input type="text" class="inp lin-desc" placeholder="Descripci√≥n l√≠nea">
              <select class="inp lin-tipo"><option value="debito">D√©bito</option><option value="credito">Cr√©dito</option></select>
              <input type="number" class="inp lin-valor" placeholder="Valor">
              <button type="button" onclick="this.closest('.asiento-linea').remove()" class="btn btn-danger btn-sm" style="padding:6px 10px">‚úï</button>
            </div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="agregarLineaBtn" class="btn btn-navy btn-sm" type="button">+ L√≠nea</button>
            <button id="guardarAsientoBtn" class="btn btn-teal btn-sm" type="button">‚úì Guardar Asiento</button>
          </div>
        </div></div>
        <div class="card"><div class="card-body">
          <div class="card-title">üìò Libro Diario ‚Äî √öltimos 50 asientos</div>
          <div class="tbl-wrap"><table id="tablaLibroDiario"><thead><tr><th>Fecha</th><th>Tipo</th><th>Descripci√≥n</th><th>D√©bito</th><th>Cr√©dito</th></tr></thead><tbody></tbody></table></div>
        </div></div>
      </div>

      <!-- PRE-CIERRE -->
      <div id="tab-cierre" class="contab-section" style="display:none">
        <div class="card"><div class="card-body">
          <div class="card-title">‚úÖ Verificaci√≥n Pre-Cierre</div>
          <div id="preCierreList"></div>
        </div></div>
      </div>

      <!-- SIMULADOR -->
      <div id="tab-simulador" class="contab-section">
        <div class="card"><div class="card-body">
          <div class="card-title">üîÆ Simulador de Escenarios Financieros</div>
          <p style="font-size:12px;color:var(--text2);margin-bottom:16px">Ajusta los par√°metros y ve c√≥mo afectan la utilidad y el flujo de caja.</p>
          <div class="sim-grid">
            <div class="sim-card">
              <div class="sim-lbl">Cambio en ingresos (%)</div>
              <div class="sim-val"><input type="range" id="simIngreso" min="-50" max="100" value="0" style="flex:1"> <span id="simIngresoVal">0%</span></div>
            </div>
            <div class="sim-card">
              <div class="sim-lbl">Cambio en gastos (%)</div>
              <div class="sim-val"><input type="range" id="simGasto" min="-30" max="100" value="0" style="flex:1"> <span id="simGastoVal">0%</span></div>
            </div>
            <div class="sim-card">
              <div class="sim-lbl">Cambio en costos (%)</div>
              <div class="sim-val"><input type="range" id="simCosto" min="-30" max="100" value="0" style="flex:1"> <span id="simCostoVal">0%</span></div>
            </div>
            <div class="sim-card">
              <div class="sim-lbl">Nuevo personal (personas)</div>
              <div class="sim-val"><input type="range" id="simPersonal" min="0" max="10" value="0" style="flex:1"> <span id="simPersonalVal">0</span></div>
            </div>
          </div>
          <button id="simularBtn" class="btn btn-primary btn-sm" style="width:auto;margin-bottom:16px" type="button">üîÆ Simular Escenario</button>
          <div id="simResultado"></div>
        </div></div>
      </div>

    </div><!-- /moduloContabilidad -->

  </div><!-- /main -->
</div><!-- /app -->

<script type="module">
import { auth, db, storage }    from './js/firebase.js';
import { initLogin, initRegister, initAuthState, doSignOut } from './js/auth.js';
import { initFeatures }          from './js/features.js';
import { initLogs, escribirLog, suscribirLogs, desuscribirLogs } from './js/logs.js';
import { initCotizaciones, cargarClientes, guardarCliente, generarCotizacion, cargarTablaCotizaciones, exportarCSV } from './js/cotizaciones.js';
import { initDashboard, suscribirDashboard, desuscribirDashboard, actualizarDashboard, setFiltroCliente } from './js/dashboard.js';
import { initFinanciero, guardarGasto, cargarCostos } from './js/financiero.js';
import { initSuperadmin, cargarSuperadmin } from './js/superadmin.js';
import { initInvitaciones, crearInvitacion, cargarInvitaciones, checkInvitacionURL } from './js/invitaciones.js';
import { initContabilidad, renderContabilidad, renderSimulador, renderPreCierre, renderLibroDiario, crearAsientoManual, crearAsientoAutomatico, PLAN_CUENTAS } from './js/contabilidad.js';
import { initOCR } from './js/ocr.js';
import { buildSidebar, mostrarModulo, checkTrialBanner, renderOnboarding, initTooltips, initHelpCenter, pushNotif, marcarNotificacionesLeidas } from './js/ui.js';
import { $, toast, logError } from './js/utils.js';
import {
  collection, doc, getDoc, getDocs, updateDoc, addDoc,
  query, where, orderBy, Timestamp
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
import { ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-storage.js";

let logoB64 = null;

checkInvitacionURL();
initLogin();
initRegister();

initAuthState({
  onLogin: async (user, empresaId, empresaData, usuarioData) => {
    $("sidebarEmpresaNombre").textContent = empresaData.nombre||"Mi Empresa";
    $("topbarTitle").textContent          = empresaData.nombre||"GESTIUM";
    $("sidebarUserName").textContent  = [usuarioData.nombre,usuarioData.apellido].filter(Boolean).join(" ")||"Usuario";
    $("sidebarUserEmail").textContent = user.email||"";
    $("sidebarUserRole").textContent  = usuarioData.superadmin?"Superadmin":(usuarioData.rol||"usuario");
    $("userAvatar").textContent = (usuarioData.nombre||"?")[0].toUpperCase();

    // Logo ‚Äî intentar desde Storage primero, luego base64 legacy
    if (empresaData.logoUrl) {
      logoB64 = empresaData.logoUrl;
      $("logoPreview").src = logoB64; $("logoPreview").style.display="block";
    } else if (empresaData.logo) {
      logoB64 = empresaData.logo;
      $("logoPreview").src = logoB64; $("logoPreview").style.display="block";
    }

    // Inicializar m√≥dulos
    initLogs(empresaId, usuarioData);
    initCotizaciones(empresaId, empresaData, usuarioData, { get:()=>logoB64 });
    initDashboard(empresaId);
    initFinanciero(empresaId);
    // ‚úÖ FIX: Guard expl√≠cito ‚Äî solo inicializar si es superadmin real
    window._esSuperAdmin = usuarioData.superadmin === true;
    if (window._esSuperAdmin) {
      initSuperadmin(empresaId);
    }
    initInvitaciones(empresaId);
    initContabilidad(empresaId, empresaData, usuarioData);
    // ‚úÖ FIX: Callback real ‚Äî al usar texto OCR lo inserta en el campo "medidas" del cotizador
    initOCR((textoOcr) => {
      const campoMedidas = document.getElementById("medidas");
      if (campoMedidas && textoOcr) {
        campoMedidas.value = textoOcr;
      }
    });

    // UI
    buildSidebar(empresaData, usuarioData);
    checkTrialBanner(empresaData);
    await cargarClientes();

    // Poblar select de terceros del asiento manual con clientes
    const asientoTercero = $("asientoTercero");
    if(asientoTercero){
      const cSnap = await getDocs(collection(db,"empresas",empresaId,"clientes"));
      cSnap.forEach(d=>{ const o=document.createElement("option"); o.value=o.textContent=d.data().nombre||d.id; asientoTercero.appendChild(o); });
    }

    // Poblar select de cuentas en l√≠nea de asiento
    const poblarCuentas = () => {
      document.querySelectorAll(".lin-cuenta").forEach(sel => {
        if(sel.options.length>1) return;
        Object.entries(PLAN_CUENTAS).forEach(([cod,c])=>{
          const o=document.createElement("option"); o.value=cod; o.textContent=`${cod} ¬∑ ${c.nombre}`; sel.appendChild(o);
        });
      });
    };
    poblarCuentas();

    // Tabs de contabilidad
    document.querySelectorAll(".contab-tab").forEach(tab=>{
      tab.addEventListener("click",()=>{
        document.querySelectorAll(".contab-tab").forEach(t=>t.classList.remove("active"));
        document.querySelectorAll(".contab-section").forEach(s=>s.classList.remove("active"));
        tab.classList.add("active");
        const target = $("tab-"+tab.dataset.tab);
        if(target) target.classList.add("active");
        if(tab.dataset.tab==="libro") renderLibroDiario();
      });
    });

    // Onboarding
    await renderOnboarding(empresaId, db, empresaData.onboardingCompletado);

    // Logs en tiempo real
    suscribirLogs();

    // Mostrar app
    $("loginScreen").style.display    = "none";
    $("app").style.display            = "block";
    $("suspendedScreen").style.display = "none";
    mostrarModulo("cotizaciones");
    document.querySelectorAll(".sb-item[data-modulo='cotizaciones']").forEach(b=>b.classList.add("active"));

    // Tooltips & ayuda
    initTooltips();
    initHelpCenter();

    // Mes por defecto
    const mesHoy = new Date();
    const mesStr = `${mesHoy.getFullYear()}-${String(mesHoy.getMonth()+1).padStart(2,"0")}`;
    if($("mesReporte"))  $("mesReporte").value  = mesStr;
    if($("mesContab"))   $("mesContab").value   = mesStr;
    if($("asientoFecha")) $("asientoFecha").valueAsDate = new Date();
  },
  onLogout: () => {
    $("loginScreen").style.display    = "flex";
    $("app").style.display            = "none";
    $("suspendedScreen").style.display = "none";
    desuscribirLogs(); desuscribirDashboard();
    logoB64 = null;
  },
  onSuspended: (msg) => {
    $("loginScreen").style.display    = "none";
    $("app").style.display            = "none";
    $("suspendedScreen").style.display = "flex";
    if ($("suspendedMsg")) $("suspendedMsg").textContent = msg;
  }
});

// ‚îÄ‚îÄ Callbacks de m√≥dulos ‚îÄ‚îÄ
window._onModuloChange = async (n) => {
  if (n === "dashboard")    { suscribirDashboard(); }
  if (n === "financiero")   { await cargarCostos(); }
  if (n === "usuarios")     { await cargarUsuarios(); }
  if (n === "superadmin")   { if (window._esSuperAdmin) await cargarSuperadmin(); }
  if (n === "invitaciones") { await cargarInvitaciones(); }
  if (n === "contabilidad") { await renderContabilidad(); }
};

// ‚îÄ‚îÄ Botones cotizaciones ‚îÄ‚îÄ
$("guardarClienteBtn")?.addEventListener("click", guardarCliente);
$("listaClientes")?.addEventListener("change", () => { if($("cliente")) $("cliente").value=$("listaClientes").value; });
$("generarBtn")?.addEventListener("click", generarCotizacion);
$("exportarCSVBtn")?.addEventListener("click", exportarCSV);
$("btnCargarMas")?.addEventListener("click", () => cargarTablaCotizaciones(true));

// ‚îÄ‚îÄ Reporte mensual ‚îÄ‚îÄ
$("generarReporteBtn")?.addEventListener("click", async () => {
  const mv = $("mesReporte")?.value; if(!mv) { toast("Selecciona el mes en el Dashboard","warn"); return; }
  const { getDocs, collection: col, query: q, where: w, orderBy: ob } = await import("https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js");
  const { generarReporte } = await import('./js/pdf.js');
  const { auth: a } = await import('./js/firebase.js');
  const [anio,mes] = mv.split("-");
  // Necesitamos empresaId del m√≥dulo auth
  const { empresaId, empresaData, usuarioData } = await import('./js/auth.js');
  const snap = await getDocs(q(col(db,"empresas",empresaId,"cotizaciones"), w("estado","==","Convertida"), ob("fecha","desc")));
  const cots = snap.docs.map(d=>d.data()).filter(v => {
    if(!v.fecha) return false; const f=v.fecha.toDate();
    return f.getFullYear()==parseInt(anio)&&(f.getMonth()+1)==parseInt(mes);
  });
  if(!cots.length) { toast("Sin ventas confirmadas en ese per√≠odo","warn"); return; }
  await generarReporte(empresaData, usuarioData, logoB64, mv, cots);
  await escribirLog("reporte_generado", `Gener√≥ reporte mensual ${mv}`);
  toast("Reporte generado ‚úì","success");
});

// ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ
$("actualizarDashboard")?.addEventListener("click", actualizarDashboard);
$("btnLimpiarFiltros")?.addEventListener("click", () => { setFiltroCliente(""); if($("clienteFiltro")) $("clienteFiltro").value=""; actualizarDashboard(); });
$("clienteFiltro")?.addEventListener("change", () => { setFiltroCliente($("clienteFiltro")?.value||""); actualizarDashboard(); });

// ‚îÄ‚îÄ Financiero ‚îÄ‚îÄ
$("guardarGastoBtn")?.addEventListener("click", guardarGasto);

// ‚îÄ‚îÄ Invitaciones ‚îÄ‚îÄ
$("crearInvBtn")?.addEventListener("click", crearInvitacion);

// ‚îÄ‚îÄ Logo ‚Äî Firebase Storage ‚îÄ‚îÄ
$("btnUploadLogo")?.addEventListener("click", () => $("logoInput")?.click());
$("logoInput")?.addEventListener("change", async (evt) => {
  const file = evt.target.files[0]; if(!file) return;
  const { empresaId, empresaData } = await import('./js/auth.js');
  try {
    // Intentar Firebase Storage; si falla (plan gratuito sin Storage), usar base64
    const imgRef = storageRef(storage, `logos/${empresaId}/${file.name}`);
    const snap = await uploadBytes(imgRef, file);
    const url  = await getDownloadURL(snap.ref);
    await updateDoc(doc(db,"empresas",empresaId), { logoUrl:url, logo:null });
    logoB64 = url; empresaData.logoUrl = url;
    $("logoPreview").src = url; $("logoPreview").style.display="block";
    await escribirLog("logo_actualizado","Actualiz√≥ logo (Storage)");
    toast("Logo actualizado ‚úì","success");
  } catch(err) {
    // Fallback: base64 (plan Spark sin Storage habilitado)
    const r = new FileReader(); r.onload = async () => {
      const b64 = r.result;
      await updateDoc(doc(db,"empresas",empresaId), { logo:b64 });
      logoB64 = b64; empresaData.logo = b64;
      $("logoPreview").src = b64; $("logoPreview").style.display="block";
      await escribirLog("logo_actualizado","Actualiz√≥ logo (base64)");
      toast("Logo guardado ‚úì","success");
    }; r.readAsDataURL(file);
  }
});

// ‚îÄ‚îÄ Backup / Restore ‚îÄ‚îÄ
$("backupBtn")?.addEventListener("click", async () => {
  const { empresaId, empresaData } = await import('./js/auth.js');
  const cS = await getDocs(collection(db,"empresas",empresaId,"clientes"));
  const vS = await getDocs(collection(db,"empresas",empresaId,"cotizaciones"));
  const data = { clientes:cS.docs.map(d=>({id:d.id,...d.data()})), cotizaciones:vS.docs.map(d=>({id:d.id,...d.data()})), empresa:empresaData, exportadoEn:new Date().toISOString() };
  const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const url = URL.createObjectURL(blob), a = document.createElement("a");
  a.href=url; a.download=`gestium_backup_${empresaId}_${new Date().toISOString().slice(0,10)}.json`; a.click(); URL.revokeObjectURL(url);
  await escribirLog("backup_generado","Descarg√≥ backup JSON");
  toast("Backup descargado ‚úì","success");
});
$("restoreBtn")?.addEventListener("click", () => $("restoreInput")?.click());
$("restoreInput")?.addEventListener("change", async (evt) => {
  const f = evt.target.files[0]; if(!f) return;
  try { JSON.parse(await f.text()); toast("Backup verificado ‚úì","success"); }
  catch(e) { toast("Error en archivo: "+e.message,"error"); }
});

// ‚îÄ‚îÄ Logout ‚îÄ‚îÄ
window._doSignOut = doSignOut;
$("sidebarLogout")?.addEventListener("click", doSignOut);

// ‚îÄ‚îÄ Notificaciones ‚îÄ‚îÄ
$("notifBtn")?.addEventListener("click", () => $("notifPanel")?.classList.toggle("show"));
$("btnMarcarLeidas")?.addEventListener("click", marcarNotificacionesLeidas);
document.addEventListener("click", e => {
  if (!$("notifPanel")?.contains(e.target) && e.target !== $("notifBtn"))
    $("notifPanel")?.classList.remove("show");
});

// ‚îÄ‚îÄ Mobile sidebar ‚îÄ‚îÄ
$("menuToggle")?.addEventListener("click", () => {
  $("sidebar")?.classList.toggle("open"); $("overlay")?.classList.toggle("on");
});
$("overlay")?.addEventListener("click", () => {
  $("sidebar")?.classList.remove("open"); $("overlay")?.classList.remove("on");
});

// ‚îÄ‚îÄ Usuarios ‚îÄ‚îÄ
async function cargarUsuarios() {
  const tbody = document.querySelector("#tablaUsuarios tbody");
  if(!tbody) return;

  const { empresaId } = await import('./js/auth.js');

  const snap = await getDocs(
    collection(db,"empresas", empresaId, "usuarios")
  );

  tbody.innerHTML="";

  snap.forEach(ds => {
    const u = ds.data();

    const rol = u.superadmin
      ? '<span class="badge badge-purple">Superadmin</span>'
      : u.rol==="admin"
        ? '<span class="badge badge-teal">Admin</span>'
        : '<span class="badge badge-gray">'+(u.rol||"vendedor")+'</span>';

    const est = u.activo
      ? '<span class="badge badge-green">Activo</span>'
      : '<span class="badge badge-red">Inactivo</span>';

    tbody.innerHTML += `
      <tr>
        <td>${[u.nombre,u.apellido].filter(Boolean).join(" ")}</td>
        <td style="font-size:11px">${u.email||"-"}</td>
        <td>${u.cargo||"-"}</td>
        <td>${rol}</td>
        <td>${est}</td>
        <td class="mono" style="font-size:10px;color:var(--text3)">
          ${(u.empresaId||"").slice(0,14)}‚Ä¶
        </td>
      </tr>`;
  });
}

// ‚îÄ‚îÄ Contabilidad ‚îÄ‚îÄ
$("actualizarContab")?.addEventListener("click", renderContabilidad);
$("btnVerificarAlertas")?.addEventListener("click", async () => {
  toast("Verificando alertas...","info");
  const { verificarAlertasFinancieras } = await import('./js/contabilidad.js');
  const alertas = await verificarAlertasFinancieras();
  if(!alertas.length) toast("Sin alertas financieras activas ‚úì","success");
  else toast(`${alertas.length} alertas detectadas. Revisa las notificaciones.`,"warn");
});
$("btnPreCierre")?.addEventListener("click", async () => {
  // Mostrar tab pre-cierre
  document.querySelectorAll(".contab-tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".contab-section").forEach(s=>s.classList.remove("active"));
  $("tab-cierre")?.classList.add("active");
  await renderPreCierre();
});

// Simulador ‚Äî sliders
["Ingreso","Gasto","Costo"].forEach(n => {
  $("sim"+n)?.addEventListener("input", () => { $("sim"+n+"Val").textContent = $("sim"+n).value+"%"; });
});
$("simPersonal")?.addEventListener("input", () => { $("simPersonalVal").textContent = $("simPersonal").value; });
$("simularBtn")?.addEventListener("click", renderSimulador);

// Asiento manual ‚Äî agregar l√≠nea
$("agregarLineaBtn")?.addEventListener("click", () => {
  const cont = $("asientoLineas"); if(!cont) return;
  const div = document.createElement("div");
  div.className="asiento-linea";
  div.style.cssText="display:grid;grid-template-columns:130px 1fr 90px 120px auto;gap:8px;margin-bottom:6px;align-items:center";
  div.innerHTML=`<select class="inp lin-cuenta" style="font-size:11px"><option value="">Cuenta</option></select>
    <input type="text" class="inp lin-desc" placeholder="Descripci√≥n l√≠nea">
    <select class="inp lin-tipo"><option value="debito">D√©bito</option><option value="credito">Cr√©dito</option></select>
    <input type="number" class="inp lin-valor" placeholder="Valor">
    <button type="button" onclick="this.closest('.asiento-linea').remove()" class="btn btn-danger btn-sm" style="padding:6px 10px">‚úï</button>`;
  Object.entries(PLAN_CUENTAS).forEach(([cod,c])=>{
    const o=document.createElement("option"); o.value=cod; o.textContent=`${cod} ¬∑ ${c.nombre}`;
    div.querySelector(".lin-cuenta").appendChild(o);
  });
  cont.appendChild(div);
});

$("guardarAsientoBtn")?.addEventListener("click", async () => {
  const fecha  = $("asientoFecha")?.value;
  const desc   = $("asientoDesc")?.value.trim();
  const tercero= $("asientoTercero")?.value;
  if(!desc) { toast("Escribe una descripci√≥n","warn"); return; }
  const lineas = [];
  document.querySelectorAll(".asiento-linea").forEach(row=>{
    const cuenta= row.querySelector(".lin-cuenta")?.value;
    const tipo  = row.querySelector(".lin-tipo")?.value;
    const valor = Number(row.querySelector(".lin-valor")?.value||0);
    const desc2 = row.querySelector(".lin-desc")?.value;
    if(cuenta&&valor) lineas.push({ cuenta, nombre:PLAN_CUENTAS[cuenta]?.nombre||cuenta, tipo, valor, descripcion:desc2 });
  });
  if(!lineas.length) { toast("Agrega al menos una l√≠nea","warn"); return; }
  const ok = await crearAsientoManual({ fecha, descripcion:desc, tercero, lineas });
  if(ok) { renderLibroDiario(); $("asientoDesc").value=""; }
});

// Exponer globalmente lo necesario
window._pushNotif = pushNotif;
</script>
</body>
</html>
